2025-12-20T04:40:14.1433990Z ##[group]Run set -e
2025-12-20T04:40:14.1434790Z [36;1mset -e[0m
2025-12-20T04:40:14.1435810Z [36;1m[0m
2025-12-20T04:40:14.1436230Z [36;1mSHADER_DIR="Sources/VectorAccelerate/Metal/Shaders"[0m
2025-12-20T04:40:14.1436820Z [36;1mFAILED=0[0m
2025-12-20T04:40:14.1437190Z [36;1mPASSED=0[0m
2025-12-20T04:40:14.1437640Z [36;1m[0m
2025-12-20T04:40:14.1438090Z [36;1mecho "## Metal Shader Validation" >> $GITHUB_STEP_SUMMARY[0m
2025-12-20T04:40:14.1438690Z [36;1mecho "" >> $GITHUB_STEP_SUMMARY[0m
2025-12-20T04:40:14.1439310Z [36;1mecho "Compiling Metal shaders with \`xcrun metal\`..." >> $GITHUB_STEP_SUMMARY[0m
2025-12-20T04:40:14.1440080Z [36;1mecho "" >> $GITHUB_STEP_SUMMARY[0m
2025-12-20T04:40:14.1440520Z [36;1m[0m
2025-12-20T04:40:14.1440910Z [36;1m# Create output directory for .air files[0m
2025-12-20T04:40:14.1441420Z [36;1mmkdir -p .build/metal-validation[0m
2025-12-20T04:40:14.1441840Z [36;1m[0m
2025-12-20T04:40:14.1442330Z [36;1m# Compile each shader individually for clear error reporting[0m
2025-12-20T04:40:14.1442980Z [36;1mfor shader in "$SHADER_DIR"/*.metal; do[0m
2025-12-20T04:40:14.1443530Z [36;1m  name=$(basename "$shader")[0m
2025-12-20T04:40:14.1443960Z [36;1m  echo "Compiling $name..."[0m
2025-12-20T04:40:14.1444350Z [36;1m[0m
2025-12-20T04:40:14.1444740Z [36;1m  if xcrun metal -c "$shader" \[0m
2025-12-20T04:40:14.1445270Z [36;1m      -o ".build/metal-validation/${name%.metal}.air" \[0m
2025-12-20T04:40:14.1445760Z [36;1m      -I "$SHADER_DIR" \[0m
2025-12-20T04:40:14.1446160Z [36;1m      -std=metal4.0 \[0m
2025-12-20T04:40:14.1446680Z [36;1m      -mmacosx-version-min=26.0 \[0m
2025-12-20T04:40:14.1447190Z [36;1m      2>&1 | tee -a metal-compile.log; then[0m
2025-12-20T04:40:14.1447690Z [36;1m    echo "- ✅ $name" >> $GITHUB_STEP_SUMMARY[0m
2025-12-20T04:40:14.1448190Z [36;1m    ((PASSED++))[0m
2025-12-20T04:40:14.1448590Z [36;1m  else[0m
2025-12-20T04:40:14.1449030Z [36;1m    echo "- ❌ $name" >> $GITHUB_STEP_SUMMARY[0m
2025-12-20T04:40:14.1449510Z [36;1m    ((FAILED++))[0m
2025-12-20T04:40:14.1449960Z [36;1m  fi[0m
2025-12-20T04:40:14.1450310Z [36;1mdone[0m
2025-12-20T04:40:14.1450880Z [36;1m[0m
2025-12-20T04:40:14.1451350Z [36;1mecho "" >> $GITHUB_STEP_SUMMARY[0m
2025-12-20T04:40:14.1452080Z [36;1mecho "**Results:** $PASSED passed, $FAILED failed" >> $GITHUB_STEP_SUMMARY[0m
2025-12-20T04:40:14.1452690Z [36;1m[0m
2025-12-20T04:40:14.1453090Z [36;1m# Fail the job if any shader failed to compile[0m
2025-12-20T04:40:14.1453570Z [36;1mif [ "$FAILED" -gt 0 ]; then[0m
2025-12-20T04:40:14.1454010Z [36;1m  echo "" >> $GITHUB_STEP_SUMMARY[0m
2025-12-20T04:40:14.1454610Z [36;1m  echo "❌ Metal shader compilation failed!" >> $GITHUB_STEP_SUMMARY[0m
2025-12-20T04:40:14.1455220Z [36;1m  echo ""[0m
2025-12-20T04:40:14.1455900Z [36;1m  echo "::error::$FAILED Metal shader(s) failed to compile. See log for details."[0m
2025-12-20T04:40:14.1456560Z [36;1m  exit 1[0m
2025-12-20T04:40:14.1456990Z [36;1melse[0m
2025-12-20T04:40:14.1457490Z [36;1m  echo "" >> $GITHUB_STEP_SUMMARY[0m
2025-12-20T04:40:14.1458190Z [36;1m  echo "✅ All Metal shaders compiled successfully" >> $GITHUB_STEP_SUMMARY[0m
2025-12-20T04:40:14.1458830Z [36;1mfi[0m
2025-12-20T04:40:14.1627490Z shell: /bin/bash -e {0}
2025-12-20T04:40:14.1629000Z env:
2025-12-20T04:40:14.1630230Z   DEVELOPER_DIR: /Applications/Xcode.app/Contents/Developer
2025-12-20T04:40:14.1631510Z ##[endgroup]
2025-12-20T04:40:14.2520720Z Compiling AdvancedTopK.metal...
2025-12-20T04:40:28.3016610Z Compiling AttentionSimilarity.metal...
2025-12-20T04:40:34.0443410Z Compiling BasicOperations.metal...
2025-12-20T04:40:34.2880800Z Compiling ChebyshevDistance.metal...
2025-12-20T04:40:34.5685810Z Compiling ClusteringShaders.metal...
2025-12-20T04:40:34.8059500Z Compiling CosineSimilarity.metal...
2025-12-20T04:40:34.9794870Z Compiling DataTransformations.metal...
2025-12-20T04:40:35.1909990Z Compiling DistanceShaders.metal...
2025-12-20T04:40:35.3421170Z Compiling DotProduct.metal...
2025-12-20T04:40:35.5149320Z Compiling HammingDistance.metal...
2025-12-20T04:40:35.7249750Z Compiling IVFCandidateBuilder.metal...
2025-12-20T04:40:35.8597540Z Compiling IVFListSearch.metal...
2025-12-20T04:40:36.0132090Z Compiling L2Distance.metal...
2025-12-20T04:40:36.1470200Z Compiling L2Normalization.metal...
2025-12-20T04:40:36.2536510Z Compiling LearnedDistance.metal...
2025-12-20T04:40:36.4340120Z Compiling ManhattanDistance.metal...
2025-12-20T04:40:36.6272030Z Compiling MinkowskiDistance.metal...
2025-12-20T04:40:36.9766150Z Compiling NeuralQuantization.metal...
2025-12-20T04:40:37.2686620Z Compiling OptimizedMatrixOps.metal...
2025-12-20T04:40:37.4423370Z Compiling ProductQuantization.metal...
2025-12-20T04:40:37.5721330Z Compiling QuantizationShaders.metal...
2025-12-20T04:40:37.7108020Z Compiling SearchAndRetrieval.metal...
2025-12-20T04:40:38.0614070Z Compiling StatisticsShaders.metal...
